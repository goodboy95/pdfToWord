```markdown
# A4_第三方依赖与许可证清单

> 适用范围：本项目（Win10/11、WPF、.NET、PDF(图片页)→Word(docx)）  
> 目的：给出**推荐第三方依赖**、其**许可证类型**、以及**二进制分发时的合规动作**。  
> 免责声明：本文不构成法律意见；正式商用发布前建议法务复核。

---

## A4.1 总体策略

1. **尽量少依赖**：核心链路仅保留 PDF 渲染（PDFium）+ 图像处理（OpenCV）+ Word 生成（OpenXML）+ JSON/日志/MVVM 等基础。
2. **优先选“宽松许可证”**：MIT / Apache-2.0 / BSD-3-Clause 这类通常对商用友好，但仍需保留版权与许可证文本。
3. **打包时附带 ThirdPartyNotices**：发布安装包/zip 时，建议附：
   - `LICENSES/` 目录（逐个依赖的许可证全文）
   - `THIRD-PARTY-NOTICES.txt`（汇总版权与许可证摘要）
   - 应用“关于/设置”页增加“第三方声明”链接（可选但推荐）

---

## A4.2 核心依赖（建议固定）

> 下表是“默认推荐实现”所需的依赖集合；你也可以替换同类库（替换时务必重新核对许可证）。

| 模块 | 组件/库 | 用途 | 推荐 NuGet/来源 | 许可证 | 合规要点 |
|---|---|---|---|---|---|
| PDF 渲染 | **PdfiumViewer** | 将 PDF 页面渲染为位图（后续 OCR/表格线检测） | `PdfiumViewer` | Apache-2.0 :contentReference[oaicite:0]{index=0} | 分发时需保留 Apache-2.0 许可证文本与版权声明 |
| PDF 内核 | **PDFium**（native） | PdfiumViewer 依赖的底层 PDF 引擎 | 由 PdfiumViewer/自带或单独捆绑 | BSD-3-Clause :contentReference[oaicite:1]{index=1} | 需附带 BSD-3-Clause 许可证；注意 PDFium third_party 可能还包含其他 BSD/MIT 类声明（建议按其仓库 ThirdPartyNotice 汇总） |
| 图像处理 | **OpenCvSharp** | OpenCV 的 .NET 封装：线检测、去噪、形态学等 | `OpenCvSharp4` | Apache-2.0（项目 LICENSE）:contentReference[oaicite:2]{index=2} | 分发时保留 Apache-2.0 许可证与版权 |
| OpenCV 运行库 | **OpenCvSharp4.runtime.win** | Windows 下 OpenCV 本体 native dll | `OpenCvSharp4.runtime.win` | OpenCV 4.5+ 为 Apache-2.0 :contentReference[oaicite:3]{index=3} | 需按 OpenCV 许可证处理（通常与 OpenCvSharp 一起声明即可） |
| Word 生成 | **Open XML SDK** | 生成 docx、表格合并单元格、分页/分节 | `DocumentFormat.OpenXml` | MIT :contentReference[oaicite:4]{index=4} | 分发时保留 MIT 许可证文本即可 |
| MVVM | **CommunityToolkit.Mvvm** | WPF MVVM（属性/命令源生成器等） | `CommunityToolkit.Mvvm` | MIT :contentReference[oaicite:5]{index=5} | 保留 MIT 许可证 |
| 日志 | **Serilog**（可选） | 本地日志/诊断包记录 | `Serilog` | Apache-2.0 :contentReference[oaicite:6]{index=6} | 保留 Apache-2.0 许可证；如加入 Sink（File 等）需追加对应依赖 |
| Gemini SDK（可选） | **Google_GenerativeAI**（非官方/第三方 SDK） | 直接调用 Gemini REST（也可用 HttpClient 自己写） | `Google_GenerativeAI` | MIT :contentReference[oaicite:7]{index=7} | 若采用该 SDK：保留 MIT 许可证；也可选择“纯 HttpClient”以减少依赖 |

> 说明：`Google_GenerativeAI` 在 NuGet 页面标注为 MIT，同时其 README 表示是“Unofficial C# SDK”，若你希望更可控，可直接用 `HttpClient` 走 REST（则无需引入该依赖，但仍受 Gemini API 的服务条款约束）。

---

## A4.3 可选依赖（按需引入）

| 场景 | 建议库 | 说明 | 许可证建议 |
|---|---|---|---|
| 更强的图片去斜/版面分析 | 自研 + OpenCV 扩展 | 继续用 OpenCvSharp，避免叠加额外视觉依赖 | 维持 Apache-2.0 体系更简单 |
| 自动更新 | Velopack / Squirrel 等（择一） | 若你计划长期分发给多台机器，更新机制有价值 | 引入前需确认其许可证并加入 notices |
| 崩溃上报 | Sentry 等（可选） | 如果涉及外部日志上报，需要额外隐私合规说明 | 许可证 + 隐私合规双重评估 |

---

## A4.4 分发合规清单（建议落地做法）

### A4.4.1 你必须做的（强烈建议视为“发布门槛”）
1. **在安装包/zip 中附带许可证文本**
   - `LICENSES/OpenCvSharp-Apache-2.0.txt`
   - `LICENSES/OpenCV-Apache-2.0.txt`
   - `LICENSES/PdfiumViewer-Apache-2.0.txt`
   - `LICENSES/PDFium-BSD-3-Clause.txt`
   - `LICENSES/OpenXmlSdk-MIT.txt`
   - `LICENSES/CommunityToolkit-MIT.txt`
   - `LICENSES/Serilog-Apache-2.0.txt`（如使用）
   - `LICENSES/Google_GenerativeAI-MIT.txt`（如使用）

2. **提供 Third-party notices 汇总**
   - `THIRD-PARTY-NOTICES.txt`：列出“库名 / 版权 / 许可证 / 来源链接（可选）”

3. **不要移除依赖自带的版权声明**
   - Apache-2.0 / BSD-3-Clause / MIT 都要求保留版权与许可声明（具体条款见各许可证原文）。

### A4.4.2 强烈建议做的（降低后续法务/客户审计成本）
- 在软件“关于”页加入：
  - “第三方声明”按钮 → 打开本地 `THIRD-PARTY-NOTICES.txt`
- 对 **native dll**（PDFium、OpenCV）单独列一行，便于审计。

---

## A4.5 依赖版本记录规范（建议）

在仓库中新增：
- `docs/third_party/ThirdPartyDependencies.lock.md`
  - 记录每次发布所用 NuGet 包的**精确版本号**与**许可证类型**（可从 NuGet metadata 导出）
- 打包脚本在 CI 里自动生成：
  - `THIRD-PARTY-NOTICES.txt`
  - `LICENSES/` 目录（把依赖仓库/nuget 的 license 文本复制进来）

---

## A4.6 特别注意：PDFium 的“多许可证碎片”风险

PDFium 虽整体常见为 BSD-3-Clause :contentReference[oaicite:8]{index=8}，但其仓库内 `third_party` 往往会带入多个组件许可证（仍多为宽松协议）。  
**建议动作**：发布前从你实际捆绑的 PDFium 二进制来源中，提取/附带它的 ThirdPartyNotice（或你自行整理汇总），避免遗漏。

---

## A4.7 参考来源（本项目主要依赖的许可证依据）

- OpenCV 4.5.0+ 采用 Apache-2.0（OpenCV 官方说明）:contentReference[oaicite:9]{index=9}  
- OpenCvSharp 项目 LICENSE（Apache-2.0）:contentReference[oaicite:10]{index=10}  
- PdfiumViewer LICENSE（Apache-2.0）:contentReference[oaicite:11]{index=11}  
- PDFium LICENSE（BSD-3-Clause）:contentReference[oaicite:12]{index=12}  
- Open XML SDK LICENSE（MIT）:contentReference[oaicite:13]{index=13}  
- CommunityToolkit LICENSE（MIT）:contentReference[oaicite:14]{index=14}  
- Serilog LICENSE（Apache-2.0）:contentReference[oaicite:15]{index=15}  
- Google_GenerativeAI（NuGet 标注 MIT）:contentReference[oaicite:16]{index=16}  

---
```
